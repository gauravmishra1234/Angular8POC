!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("is-number")):"function"==typeof define&&define.amd?define("ngx-infinite-scroller",["exports","@angular/core","rxjs","rxjs/operators","is-number"],e):e((t=t||self)["ngx-infinite-scroller"]={},t.ng.core,t.rxjs,t.rxjs.operators,t.isNumber)}(this,function(t,e,o,i,r){"use strict";r=r&&r.hasOwnProperty("default")?r["default"]:r;var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function l(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}function s(t,e,o,i){var r,n=arguments.length,l=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(l=(n<3?r(l):n>3?r(e,o,l):r(e,o))||l);return n>3&&l&&Object.defineProperty(e,o,l),l}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var p,u=function(){function t(){}return Object.defineProperty(t.prototype,"scrollTop",{get:function(){return this._el.nativeElement.scrollTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollHeight",{get:function(){return this._el.nativeElement.scrollHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientHeight",{get:function(){return this._el.nativeElement.clientHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initMode",{get:function(){return this._initMode},set:function(t){this._initMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollStreamActive",{get:function(){return this._scrollStreamActive},set:function(t){this._scrollStreamActive=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousScrollPositionpUpdated",{get:function(){return this._previousScrollPositionpUpdated},set:function(t){this._previousScrollPositionpUpdated=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousScrollTop",{get:function(){return this._previousScrollTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousScrollHeight",{get:function(){return this._previousScrollHeight},enumerable:!0,configurable:!0}),t.prototype.setup=function(t){this._el=t.el,this._initMode=t.initMode,this._scrollStreamActive=t.scrollStreamActive,this._previousScrollPositionpUpdated=t.previousScrollPositionpUpdated,this.updatePreviousScrollTop(),this.updatePreviousScrollHeight()},t.prototype.updatePreviousScrollTop=function(){this._previousScrollTop=this._el.nativeElement.scrollTop},t.prototype.updatePreviousScrollHeight=function(){this._previousScrollHeight=this._el.nativeElement.scrollHeight},t}();!function(t){t.DEFAULT="DEFAULT",t.TOP="TOP",t.MIDDLE="MIDDLE",t.BOTTOM="BOTTOM"}(p||(p={}));var a=function(){return function(){}}(),h=function(){function t(t,e){this.directive=t,this.state=e}return t.prototype.wasScrolledDown=function(t,e){return t.scrollTop<e.scrollTop},t.prototype.wasScrolledUp=function(t,e){return!this.wasScrolledDown(t,e)},t.prototype.isScrollDownEnough=function(t,e){return(t.scrollTop+t.clientHeight)/t.scrollHeight>e/100},t.prototype.isScrollUpEnough=function(t,e){return t.scrollTop/t.scrollHeight<e/100},t.prototype.getInitialScrollPositionValue=function(t){var e=this.directive.initialScrollPosition;if(r(e))return Number(e);var o=this.getInitialScrollPositions();return e===p.DEFAULT?o[t]:o[e]},t.prototype.getInitialScrollPositions=function(){var t,e=this.state,o=e.scrollHeight,i=e.clientHeight;return(t={})[p.TOP]=0,t[p.MIDDLE]=o/2-i/2,t[p.BOTTOM]=o,t},t}(),g=function(t){function e(e,o){return t.call(this,e,o)||this}return l(e,t),e.prototype.scrollDirectionChanged=function(e){var o=this;return e.pipe(i.filter(function(e){return t.prototype.wasScrolledUp.call(o,e[0],e[1])}))},e.prototype.scrollRequestZoneChanged=function(e){var o=this;return e.pipe(i.filter(function(e){return t.prototype.isScrollUpEnough.call(o,e[1],o.directive.scrollUpPercentilePositionTrigger)}))},e.prototype.askForUpdate=function(){this.directive.onScrollUp.next()},e.prototype.setInitialScrollPosition=function(){var e=t.prototype.getInitialScrollPositionValue.call(this,p.BOTTOM);this.directive.scrollTo(e)},e.prototype.setPreviousScrollPosition=function(){var t=this.state.previousScrollTop+(this.state.scrollHeight-this.state.previousScrollHeight);this.directive.scrollTo(t)},e}(h),f=function(t){function e(e,o){return t.call(this,e,o)||this}return l(e,t),e.prototype.scrollDirectionChanged=function(e){var o=this;return e.pipe(i.filter(function(e){return t.prototype.wasScrolledDown.call(o,e[0],e[1])}))},e.prototype.scrollRequestZoneChanged=function(e){var o=this;return e.pipe(i.filter(function(e){return t.prototype.isScrollDownEnough.call(o,e[1],o.directive.scrollDownPercentilePositionTrigger)}))},e.prototype.askForUpdate=function(){this.directive.onScrollDown.next()},e.prototype.setInitialScrollPosition=function(){var e=t.prototype.getInitialScrollPositionValue.call(this,p.TOP);this.directive.scrollTo(e)},e.prototype.setPreviousScrollPosition=function(){var t=this.state.previousScrollTop;this.directive.scrollTo(t)},e}(h),d=function(t){function e(e,o){return t.call(this,e,o)||this}return l(e,t),e.prototype.scrollDirectionChanged=function(t){return t},e.prototype.scrollRequestZoneChanged=function(e){var o=this;return e.pipe(i.filter(function(e){return t.prototype.isScrollUpEnough.call(o,e[1],o.directive.scrollUpPercentilePositionTrigger)||t.prototype.isScrollDownEnough.call(o,e[1],o.directive.scrollDownPercentilePositionTrigger)}),i.tap(function(e){o.scrolledUp=t.prototype.wasScrolledUp.call(o,e[0],e[1])}))},e.prototype.askForUpdate=function(){this.scrolledUp?this.directive.onScrollUp.next():this.directive.onScrollDown.next()},e.prototype.setInitialScrollPosition=function(){var e=t.prototype.getInitialScrollPositionValue.call(this,p.MIDDLE);this.directive.scrollTo(e)},e.prototype.setPreviousScrollPosition=function(){var t;t=this.scrolledUp?this.state.previousScrollTop+(this.state.scrollHeight-this.state.previousScrollHeight):this.state.previousScrollTop,this.directive.scrollTo(t)},e}(h),v=function(){function t(t,e){this.directive=t,this.state=e,this.DEFAULT_REQUEST_TIMEOUT=3e4}return t.prototype.start=function(){var t=this;this.listener=window.requestAnimationFrame(this.listen.bind(this)),this.httpRequestTimeout||(this.httpRequestTimeout=setTimeout(function(){t.stopIfRequestTimeout()},this.DEFAULT_REQUEST_TIMEOUT))},t.prototype.stop=function(){window.cancelAnimationFrame(this.listener),clearTimeout(this.httpRequestTimeout),this.httpRequestTimeout=null},t.prototype.listen=function(){this.state.previousScrollHeight!==this.state.scrollHeight?(this.stop(),this.directive.onScrollbarHeightChanged()):this.start()},t.prototype.stopIfRequestTimeout=function(){this.state.previousScrollPositionpUpdated||this.stop()},t}(),y=function(t){function r(i,r,n){var l=t.call(this)||this;return l.el=i,l.renderer=r,l.state=n,l.strategy="scrollingToBottom",l.initialScrollPosition=p.DEFAULT,l.scrollbarAnimationInterval=100,l.scrollDebounceTimeAfterScrollHeightChanged=50,l.scrollDebounceTimeAfterDOMMutationOnInit=1e3,l.scrollUpPercentilePositionTrigger=2,l.scrollDownPercentilePositionTrigger=98,l.onScrollUp=new e.EventEmitter,l.onScrollDown=new e.EventEmitter,l.scrollHeightChanged=new o.Subject,l.domMutationEmitter=new o.Subject,l.state.setup({el:i,initMode:!0,scrollStreamActive:!0,previousScrollPositionpUpdated:!1}),l}return l(r,t),Object.defineProperty(r.prototype,"scrollPairChanged",{get:function(){var t=this;if(this.scrollChanged)return this.scrollChanged.pipe(i.takeWhile(function(){return t.state.scrollStreamActive}),i.map(function(t){return{scrollHeight:t.target.scrollHeight,scrollTop:t.target.scrollTop,clientHeight:t.target.clientHeight}}),i.pairwise(),i.debounceTime(this.scrollbarAnimationInterval))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scrollDirectionChanged",{get:function(){return this.scrollingStrategy.scrollDirectionChanged(this.scrollPairChanged)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scrollRequestZoneChanged",{get:function(){var t=this;return this.scrollingStrategy.scrollRequestZoneChanged(this.scrollDirectionChanged).pipe(i.tap(function(){t.state.updatePreviousScrollTop(),t.state.updatePreviousScrollHeight(),t.state.previousScrollPositionpUpdated=!1,t.scrollHeightListener.start()}))},enumerable:!0,configurable:!0}),r.prototype.ngOnInit=function(){this.useStrategy(),this.useScrollHeightListener(),this.registerScrollEventHandler(),this.registerMutationObserver(),this.registerInitialScrollPostionHandler(),this.registerPreviousScrollPositionHandler()},r.prototype.ngAfterViewInit=function(){this.registerScrollSpy()},r.prototype.ngOnDestroy=function(){this.domMutationObserver.disconnect()},r.prototype.scrollTo=function(t){this.state.scrollStreamActive=!1,this.renderer.setProperty(this.el.nativeElement,"scrollTop",t),this.state.scrollStreamActive=!0},r.prototype.onScrollbarHeightChanged=function(){this.scrollHeightChanged.next()},r.prototype.registerScrollEventHandler=function(){this.scrollChanged=o.fromEvent(this.el.nativeElement,"scroll")},r.prototype.registerMutationObserver=function(){var t=this;this.domMutationObserver=new MutationObserver(function(e){t.domMutationEmitter.next(e)});this.domMutationObserver.observe(this.el.nativeElement,{attributes:!0,childList:!0,characterData:!0})},r.prototype.registerInitialScrollPostionHandler=function(){var t=this;this.domMutationEmitter.pipe(i.takeWhile(function(){return t.state.initMode}),i.debounceTime(this.scrollDebounceTimeAfterDOMMutationOnInit)).subscribe(function(){t.scrollingStrategy.setInitialScrollPosition(),t.state.initMode=!1})},r.prototype.registerPreviousScrollPositionHandler=function(){var t=this;o.zip(this.scrollRequestZoneChanged,this.scrollHeightChanged).pipe(i.skipWhile(function(){return t.state.initMode}),i.debounceTime(this.scrollDebounceTimeAfterScrollHeightChanged)).subscribe(function(){t.scrollingStrategy.setPreviousScrollPosition(),t.state.previousScrollPositionpUpdated=!0})},r.prototype.registerScrollSpy=function(){var t=this;this.scrollRequestZoneChanged.subscribe(function(){t.scrollingStrategy.askForUpdate()})},r.prototype.useStrategy=function(){switch(this.strategy){case"scrollingToBoth":this.scrollingStrategy=new d(this,this.state);break;case"scrollingToTop":this.scrollingStrategy=new g(this,this.state);break;case"scrollingToBottom":default:this.scrollingStrategy=new f(this,this.state)}},r.prototype.useScrollHeightListener=function(){this.scrollHeightListener=new v(this,this.state)},s([e.Input(),c("design:type",String)],r.prototype,"strategy",void 0),s([e.Input(),c("design:type",Object)],r.prototype,"initialScrollPosition",void 0),s([e.Input(),c("design:type",Object)],r.prototype,"scrollbarAnimationInterval",void 0),s([e.Input(),c("design:type",Object)],r.prototype,"scrollDebounceTimeAfterScrollHeightChanged",void 0),s([e.Input(),c("design:type",Object)],r.prototype,"scrollDebounceTimeAfterDOMMutationOnInit",void 0),s([e.Input(),c("design:type",Object)],r.prototype,"scrollUpPercentilePositionTrigger",void 0),s([e.Input(),c("design:type",Object)],r.prototype,"scrollDownPercentilePositionTrigger",void 0),s([e.Output(),c("design:type",e.EventEmitter)],r.prototype,"onScrollUp",void 0),s([e.Output(),c("design:type",e.EventEmitter)],r.prototype,"onScrollDown",void 0),r=s([e.Directive({selector:"[ngxInfiniteScroller]"}),c("design:paramtypes",[e.ElementRef,e.Renderer2,u])],r)}(a),S=function(){function t(){}return t=s([e.NgModule({declarations:[y],imports:[],exports:[y],providers:[u],bootstrap:[]})],t)}();t.NgxInfiniteScrollerModule=S,t.ɵa=y,t.ɵb=a,t.ɵc=u,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-infinite-scroller.umd.min.js.map