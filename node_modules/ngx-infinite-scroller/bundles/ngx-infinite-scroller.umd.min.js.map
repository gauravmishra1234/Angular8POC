{"version":3,"sources":["../../node_modules/tslib/tslib.es6.js","ng://ngx-infinite-scroller/src/app/enum/initial-scroll-position-type.enum.ts","ng://ngx-infinite-scroller/src/app/directive-state.service.ts","ng://ngx-infinite-scroller/src/app/directive-context.ts","ng://ngx-infinite-scroller/src/app/scrolling-strategy/strategy-base.ts","ng://ngx-infinite-scroller/src/app/scrolling-strategy/scrolling-to-top.ts","ng://ngx-infinite-scroller/src/app/scrolling-strategy/scrolling-to-bottom.ts","ng://ngx-infinite-scroller/src/app/scrolling-strategy/scrolling-to-both.ts","ng://ngx-infinite-scroller/src/app/scroll-height-listener/scroll-height-listener.ts","ng://ngx-infinite-scroller/src/app/ngx-infinite-scroller.directive.ts","ng://ngx-infinite-scroller/src/app/ngx-infinite-scroller.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__metadata","metadataKey","metadataValue","metadata","InitialScrollPosition","DirectiveStateService","_el","nativeElement","scrollTop","scrollHeight","clientHeight","_initMode","initMode","_scrollStreamActive","active","_previousScrollPositionpUpdated","previousScrollPositionpUpdated","_previousScrollTop","_previousScrollHeight","setup","params","el","scrollStreamActive","updatePreviousScrollTop","updatePreviousScrollHeight","StrategyBase","directive","state","wasScrolledDown","prevPos","currentPos","wasScrolledUp","isScrollDownEnough","pos","scrollPositionTrigger","isScrollUpEnough","getInitialScrollPositionValue","defaultScrollPosition","initialScrollPosition","isNumber","Number","initialScrollPositions","getInitialScrollPositions","DEFAULT","_b","_a","TOP","MIDDLE","BOTTOM","ScrollingToTop","_super","call","tslib_1.__extends","scrollDirectionChanged","scrollPairChanged","_this","pipe","filter","scrollPositions","scrollRequestZoneChanged","scrollUpPercentilePositionTrigger","askForUpdate","onScrollUp","next","setInitialScrollPosition","initialScrollPositionValue","scrollTo","setPreviousScrollPosition","prevScrollPosition","previousScrollTop","previousScrollHeight","ScrollingToBottom","scrollDownPercentilePositionTrigger","onScrollDown","ScrollingToBoth","tap","scrolledUp","ScrollHeightListener","DEFAULT_REQUEST_TIMEOUT","start","listener","window","requestAnimationFrame","listen","bind","httpRequestTimeout","setTimeout","stopIfRequestTimeout","stop","cancelAnimationFrame","clearTimeout","onScrollbarHeightChanged","NgxInfiniteScrollerDirective","renderer","strategy","scrollbarAnimationInterval","scrollDebounceTimeAfterScrollHeightChanged","scrollDebounceTimeAfterDOMMutationOnInit","EventEmitter","scrollHeightChanged","Subject","domMutationEmitter","scrollChanged","takeWhile","map","e","pairwise","debounceTime","scrollingStrategy","scrollHeightListener","ngOnInit","useStrategy","useScrollHeightListener","registerScrollEventHandler","registerMutationObserver","registerInitialScrollPostionHandler","registerPreviousScrollPositionHandler","ngAfterViewInit","registerScrollSpy","ngOnDestroy","domMutationObserver","disconnect","position","setProperty","fromEvent","MutationObserver","mutations","observe","attributes","childList","characterData","subscribe","zip","skipWhile","tslib_1.__decorate","Input","Output","Directive","selector","ElementRef","Renderer2","DirectiveContext","NgxInfiniteScrollerModule","NgModule","declarations","imports","exports","providers","bootstrap"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export enum InitialScrollPosition {\n  DEFAULT = 'DEFAULT',\n  TOP = 'TOP',\n  MIDDLE = 'MIDDLE',\n  BOTTOM = 'BOTTOM',\n}\n","import { ElementRef } from '@angular/core';\n\nexport class DirectiveStateService {\n\n  public get scrollTop(): number {\n    return this._el.nativeElement.scrollTop;\n  }\n\n  public get scrollHeight(): number {\n    return this._el.nativeElement.scrollHeight;\n  }\n\n  public get clientHeight(): number {\n    return this._el.nativeElement.clientHeight;\n  }\n\n  public get initMode(): boolean {\n    return this._initMode;\n  }\n\n  public set initMode(initMode: boolean) {\n    this._initMode = initMode;\n  }\n\n  public get scrollStreamActive(): boolean {\n    return this._scrollStreamActive;\n  }\n\n  public set scrollStreamActive(active: boolean) {\n    this._scrollStreamActive = active;\n  }\n\n  public get previousScrollPositionpUpdated(): boolean {\n    return this._previousScrollPositionpUpdated;\n  }\n\n  public set previousScrollPositionpUpdated(previousScrollPositionpUpdated: boolean) {\n    this._previousScrollPositionpUpdated = previousScrollPositionpUpdated;\n  }\n\n  public get previousScrollTop(): number {\n    return this._previousScrollTop;\n  }\n\n  public get previousScrollHeight(): number {\n    return this._previousScrollHeight;\n  }\n\n  private _el: ElementRef;\n\n  private _initMode: boolean;\n\n  private _scrollStreamActive: boolean;\n\n  private _previousScrollPositionpUpdated: boolean;\n\n  private _previousScrollTop: number;\n\n  private _previousScrollHeight: number;\n\n  public setup(params: {\n    el: ElementRef,\n    initMode: boolean,\n    scrollStreamActive: boolean,\n    previousScrollPositionpUpdated: boolean\n  }): void {\n    this._el = params.el;\n    this._initMode = params.initMode;\n    this._scrollStreamActive = params.scrollStreamActive;\n    this._previousScrollPositionpUpdated = params.previousScrollPositionpUpdated;\n    this.updatePreviousScrollTop();\n    this.updatePreviousScrollHeight();\n  }\n\n  public updatePreviousScrollTop(): void {\n    this._previousScrollTop = this._el.nativeElement.scrollTop;\n  }\n\n  public updatePreviousScrollHeight(): void {\n    this._previousScrollHeight = this._el.nativeElement.scrollHeight;\n  }\n}\n","import { ScrollingStrategy } from './model/scrolling-strategy.model';\n\nexport abstract class DirectiveContext {\n\n  protected scrollingStrategy: ScrollingStrategy;\n\n  constructor() { }\n}\n","import isNumber from 'is-number';\n\nimport { NgxInfiniteScrollerDirective } from '../ngx-infinite-scroller.directive';\nimport { DirectiveStateService } from '../directive-state.service';\n\nimport { ScrollPosition } from '../model/scroll-position.model';\nimport { InitialScrollPosition } from '../enum/initial-scroll-position-type.enum';\n\nexport abstract class StrategyBase {\n  constructor(\n    protected directive: NgxInfiniteScrollerDirective,\n    protected state: DirectiveStateService\n  ) { }\n\n  protected wasScrolledDown(prevPos: ScrollPosition, currentPos: ScrollPosition): boolean {\n    return prevPos.scrollTop < currentPos.scrollTop;\n  }\n\n  protected wasScrolledUp(prevPos: ScrollPosition, currentPos: ScrollPosition): boolean {\n    return !this.wasScrolledDown(prevPos, currentPos);\n  }\n\n  protected isScrollDownEnough(pos: ScrollPosition, scrollPositionTrigger: number): boolean {\n    return ((pos.scrollTop + pos.clientHeight) / pos.scrollHeight) > (scrollPositionTrigger / 100);\n  }\n\n  protected isScrollUpEnough(pos: ScrollPosition, scrollPositionTrigger: number): boolean {\n    return (pos.scrollTop / pos.scrollHeight) < (scrollPositionTrigger / 100);\n  }\n\n  protected getInitialScrollPositionValue(defaultScrollPosition: InitialScrollPosition): number {\n    const { initialScrollPosition } = this.directive;\n\n    if (isNumber(initialScrollPosition)) {\n      return Number(initialScrollPosition);\n    }\n\n    const initialScrollPositions: { [key: string]: number } = this.getInitialScrollPositions();\n\n    if (initialScrollPosition === InitialScrollPosition.DEFAULT) {\n      return initialScrollPositions[defaultScrollPosition];\n    }\n\n    return initialScrollPositions[initialScrollPosition];\n  }\n\n  private getInitialScrollPositions(): { [key: string]: number } {\n    const { scrollHeight, clientHeight } = this.state;\n\n    return {\n      [InitialScrollPosition.TOP]: 0,\n      [InitialScrollPosition.MIDDLE]: scrollHeight / 2 - clientHeight / 2,\n      [InitialScrollPosition.BOTTOM]: scrollHeight,\n    };\n  }\n}\n","import { Observable } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { StrategyBase } from './strategy-base';\n\nimport { NgxInfiniteScrollerDirective } from '../ngx-infinite-scroller.directive';\nimport { DirectiveStateService } from '../directive-state.service';\n\nimport { ScrollingStrategy } from '../model/scrolling-strategy.model';\nimport { ScrollPosition } from '../model/scroll-position.model';\nimport { InitialScrollPosition } from '../enum/initial-scroll-position-type.enum';\n\nexport class ScrollingToTop extends StrategyBase implements ScrollingStrategy {\n\n  constructor(\n    directive: NgxInfiniteScrollerDirective,\n    state: DirectiveStateService\n  ) {\n    super(directive, state);\n  }\n\n  public scrollDirectionChanged(scrollPairChanged: Observable<ScrollPosition[]>):\n    Observable<ScrollPosition[]> {\n    return scrollPairChanged.pipe(\n      filter((scrollPositions: ScrollPosition[]) => {\n        return super.wasScrolledUp(\n          scrollPositions[0],\n          scrollPositions[1]\n        );\n      })\n    );\n  }\n\n  public scrollRequestZoneChanged(scrollDirectionChanged: Observable<ScrollPosition[]>):\n    Observable<ScrollPosition[]> {\n    return scrollDirectionChanged.pipe(\n      filter((scrollPositions: ScrollPosition[]) => {\n        return super.isScrollUpEnough(\n          scrollPositions[1],\n          this.directive.scrollUpPercentilePositionTrigger\n        );\n      })\n    );\n  }\n\n  public askForUpdate(): void {\n    this.directive.onScrollUp.next();\n  }\n\n  public setInitialScrollPosition(): void {\n    const initialScrollPositionValue = super.getInitialScrollPositionValue(\n      InitialScrollPosition.BOTTOM,\n    );\n\n    this.directive.scrollTo(initialScrollPositionValue);\n  }\n\n  public setPreviousScrollPosition(): void {\n    const prevScrollPosition = this.state.previousScrollTop +\n      (this.state.scrollHeight - this.state.previousScrollHeight);\n    this.directive.scrollTo(prevScrollPosition);\n  }\n}\n","import { Observable } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { StrategyBase } from './strategy-base';\n\nimport { NgxInfiniteScrollerDirective } from '../ngx-infinite-scroller.directive';\nimport { DirectiveStateService } from '../directive-state.service';\n\nimport { ScrollingStrategy } from '../model/scrolling-strategy.model';\nimport { ScrollPosition } from '../model/scroll-position.model';\nimport { InitialScrollPosition } from '../enum/initial-scroll-position-type.enum';\n\nexport class ScrollingToBottom extends StrategyBase implements ScrollingStrategy {\n\n  constructor(\n    directive: NgxInfiniteScrollerDirective,\n    state: DirectiveStateService\n  ) {\n    super(directive, state);\n  }\n\n  public scrollDirectionChanged(scrollPairChanged: Observable<ScrollPosition[]>):\n    Observable<ScrollPosition[]> {\n    return scrollPairChanged.pipe(\n      filter((scrollPositions: ScrollPosition[]) => {\n        return super.wasScrolledDown(\n          scrollPositions[0],\n          scrollPositions[1]\n        );\n      })\n    );\n  }\n\n  public scrollRequestZoneChanged(scrollDirectionChanged: Observable<ScrollPosition[]>):\n    Observable<ScrollPosition[]> {\n    return scrollDirectionChanged.pipe(\n      filter((scrollPositions: ScrollPosition[]) => {\n        return super.isScrollDownEnough(\n          scrollPositions[1],\n          this.directive.scrollDownPercentilePositionTrigger\n        );\n      })\n    );\n  }\n\n  public askForUpdate(): void {\n    this.directive.onScrollDown.next();\n  }\n\n  public setInitialScrollPosition(): void {\n    const initialScrollPositionValue = super.getInitialScrollPositionValue(\n      InitialScrollPosition.TOP,\n    );\n\n    this.directive.scrollTo(initialScrollPositionValue);\n  }\n\n  public setPreviousScrollPosition(): void {\n    const prevScrollPosition = this.state.previousScrollTop;\n    this.directive.scrollTo(prevScrollPosition);\n  }\n}\n","import { Observable } from 'rxjs';\nimport { tap, filter } from 'rxjs/operators';\n\nimport { StrategyBase } from './strategy-base';\n\nimport { NgxInfiniteScrollerDirective } from '../ngx-infinite-scroller.directive';\nimport { DirectiveStateService } from '../directive-state.service';\n\nimport { ScrollingStrategy } from '../model/scrolling-strategy.model';\nimport { ScrollPosition } from '../model/scroll-position.model';\nimport { InitialScrollPosition } from '../enum/initial-scroll-position-type.enum';\n\nexport class ScrollingToBoth extends StrategyBase implements ScrollingStrategy {\n\n  private scrolledUp: boolean;\n\n  constructor(\n    directive: NgxInfiniteScrollerDirective,\n    state: DirectiveStateService\n  ) {\n    super(directive, state);\n  }\n\n  public scrollDirectionChanged(scrollPairChanged: Observable<ScrollPosition[]>):\n    Observable<ScrollPosition[]> {\n    return scrollPairChanged;\n  }\n\n  public scrollRequestZoneChanged(scrollDirectionChanged: Observable<ScrollPosition[]>):\n    Observable<ScrollPosition[]> {\n    return scrollDirectionChanged.pipe(\n      filter((scrollPositions: ScrollPosition[]) => {\n        return (super.isScrollUpEnough(\n          scrollPositions[1],\n          this.directive.scrollUpPercentilePositionTrigger\n        ) || super.isScrollDownEnough(\n          scrollPositions[1],\n          this.directive.scrollDownPercentilePositionTrigger\n        ));\n      }),\n      tap((scrollPositions: ScrollPosition[]) => {\n        this.scrolledUp = super.wasScrolledUp(\n          scrollPositions[0],\n          scrollPositions[1]);\n      })\n    );\n  }\n\n  public askForUpdate(): void {\n    if (this.scrolledUp) {\n      this.directive.onScrollUp.next();\n    } else {\n      this.directive.onScrollDown.next();\n    }\n  }\n\n  public setInitialScrollPosition(): void {\n    const initialScrollPositionValue = super.getInitialScrollPositionValue(\n      InitialScrollPosition.MIDDLE,\n    );\n\n    this.directive.scrollTo(initialScrollPositionValue);\n  }\n\n  public setPreviousScrollPosition(): void {\n    let prevScrollPosition;\n\n    if (this.scrolledUp) {\n      prevScrollPosition = this.state.previousScrollTop +\n        (this.state.scrollHeight - this.state.previousScrollHeight);\n    } else {\n      prevScrollPosition = this.state.previousScrollTop;\n    }\n\n    this.directive.scrollTo(prevScrollPosition);\n  }\n}\n","import { NgxInfiniteScrollerDirective } from '../ngx-infinite-scroller.directive';\nimport { DirectiveStateService } from '../directive-state.service';\n\nexport class ScrollHeightListener {\n\n  private DEFAULT_REQUEST_TIMEOUT = 30000;\n\n  private listener: number;\n\n  private httpRequestTimeout: any;\n\n  constructor(\n    private directive: NgxInfiniteScrollerDirective,\n    private state: DirectiveStateService\n  ) { }\n\n  public start(): void {\n    this.listener = window.requestAnimationFrame(this.listen.bind(this));\n\n    if (!this.httpRequestTimeout) {\n      this.httpRequestTimeout = setTimeout(\n        () => {\n          this.stopIfRequestTimeout();\n        },\n        this.DEFAULT_REQUEST_TIMEOUT\n      );\n    }\n  }\n\n  public stop(): void {\n    window.cancelAnimationFrame(this.listener);\n    clearTimeout(this.httpRequestTimeout);\n    this.httpRequestTimeout = null;\n  }\n\n  private listen(): void {\n    if (this.state.previousScrollHeight !== this.state.scrollHeight) {\n      this.stop();\n      this.directive.onScrollbarHeightChanged();\n    } else {\n      this.start();\n    }\n  }\n\n  private stopIfRequestTimeout(): void {\n    if (!this.state.previousScrollPositionpUpdated) {\n      this.stop();\n    }\n  }\n}\n","import {\r\n  Directive,\r\n  OnDestroy,\r\n  OnInit,\r\n  AfterViewInit,\r\n  ElementRef,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  Renderer2,\r\n} from '@angular/core';\r\n\r\nimport { Observable, Subject, zip, fromEvent } from 'rxjs';\r\n\r\nimport { tap, map, pairwise, takeWhile, skipWhile, debounceTime } from 'rxjs/operators';\r\n\r\nimport { DirectiveStateService } from './directive-state.service';\r\n\r\nimport { ScrollPosition } from './model/scroll-position.model';\r\nimport { InitialScrollPosition } from './enum/initial-scroll-position-type.enum';\r\n\r\nimport { DirectiveContext } from './directive-context';\r\nimport { ScrollingToTop } from './scrolling-strategy/scrolling-to-top';\r\nimport { ScrollingToBottom } from './scrolling-strategy/scrolling-to-bottom';\r\nimport { ScrollingToBoth } from './scrolling-strategy/scrolling-to-both';\r\n\r\nimport { ScrollHeightListener } from './scroll-height-listener/scroll-height-listener';\r\n\r\n@Directive({\r\n  selector: '[ngxInfiniteScroller]'\r\n})\r\nexport class NgxInfiniteScrollerDirective\r\n  extends DirectiveContext\r\n  implements OnInit, AfterViewInit, OnDestroy {\r\n\r\n  @Input()\r\n  public strategy: string = 'scrollingToBottom';\r\n\r\n  @Input()\r\n  public initialScrollPosition: InitialScrollPosition | number = InitialScrollPosition.DEFAULT;\r\n\r\n  @Input()\r\n  public scrollbarAnimationInterval = 100;\r\n\r\n  @Input()\r\n  public scrollDebounceTimeAfterScrollHeightChanged = 50;\r\n\r\n  @Input()\r\n  public scrollDebounceTimeAfterDOMMutationOnInit = 1000;\r\n\r\n  @Input()\r\n  public scrollUpPercentilePositionTrigger = 2;\r\n\r\n  @Input()\r\n  public scrollDownPercentilePositionTrigger = 98;\r\n\r\n  @Output()\r\n  public onScrollUp: EventEmitter<null> = new EventEmitter<null>();\r\n\r\n  @Output()\r\n  public onScrollDown: EventEmitter<null> = new EventEmitter<null>();\r\n\r\n  private scrollHeightListener: ScrollHeightListener;\r\n\r\n  private scrollHeightChanged: Subject<null> = new Subject<null>();\r\n\r\n  private domMutationObserver: MutationObserver;\r\n\r\n  private domMutationEmitter: Subject<MutationRecord[]> = new Subject<MutationRecord[]>();\r\n\r\n  private scrollChanged: Observable<Event>;\r\n\r\n  private get scrollPairChanged(): Observable<ScrollPosition[]> {\r\n    if (this.scrollChanged) {\r\n      return this.scrollChanged.pipe(\r\n        takeWhile(() => this.state.scrollStreamActive),\r\n        map((e: any) => {\r\n          return <ScrollPosition>{\r\n            scrollHeight: e.target.scrollHeight,\r\n            scrollTop: e.target.scrollTop,\r\n            clientHeight: e.target.clientHeight,\r\n          };\r\n        }),\r\n        pairwise(),\r\n        debounceTime(this.scrollbarAnimationInterval)\r\n      );\r\n    }\r\n  }\r\n\r\n  private get scrollDirectionChanged(): Observable<ScrollPosition[]> {\r\n    return this.scrollingStrategy.scrollDirectionChanged(this.scrollPairChanged);\r\n  }\r\n\r\n  private get scrollRequestZoneChanged(): Observable<ScrollPosition[]> {\r\n    return this.scrollingStrategy.scrollRequestZoneChanged(this.scrollDirectionChanged).pipe(\r\n      tap(() => {\r\n        this.state.updatePreviousScrollTop();\r\n        this.state.updatePreviousScrollHeight();\r\n        this.state.previousScrollPositionpUpdated = false;\r\n        this.scrollHeightListener.start();\r\n      })\r\n    );\r\n  }\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private renderer: Renderer2,\r\n    private state: DirectiveStateService\r\n  ) {\r\n    super();\r\n    this.state.setup({\r\n      el: el,\r\n      initMode: true,\r\n      scrollStreamActive: true,\r\n      previousScrollPositionpUpdated: false\r\n    });\r\n  }\r\n\r\n  public ngOnInit(): void {\r\n    this.useStrategy();\r\n    this.useScrollHeightListener();\r\n\r\n    this.registerScrollEventHandler();\r\n    this.registerMutationObserver();\r\n    this.registerInitialScrollPostionHandler();\r\n    this.registerPreviousScrollPositionHandler();\r\n  }\r\n\r\n  public ngAfterViewInit(): void {\r\n    this.registerScrollSpy();\r\n  }\r\n\r\n  public ngOnDestroy(): void {\r\n    this.domMutationObserver.disconnect();\r\n  }\r\n\r\n  public scrollTo(position: number): void {\r\n    this.state.scrollStreamActive = false;\r\n    this.renderer.setProperty(this.el.nativeElement, 'scrollTop', position);\r\n    this.state.scrollStreamActive = true;\r\n  }\r\n\r\n  public onScrollbarHeightChanged(): void {\r\n    this.scrollHeightChanged.next();\r\n  }\r\n\r\n  private registerScrollEventHandler(): void {\r\n    this.scrollChanged = fromEvent(this.el.nativeElement, 'scroll');\r\n  }\r\n\r\n  private registerMutationObserver(): void {\r\n    this.domMutationObserver = new MutationObserver(\r\n      (mutations: MutationRecord[]) => {\r\n        this.domMutationEmitter.next(mutations);\r\n      });\r\n\r\n    const config = { attributes: true, childList: true, characterData: true };\r\n    this.domMutationObserver.observe(this.el.nativeElement, config);\r\n  }\r\n\r\n  private registerInitialScrollPostionHandler(): void {\r\n    this.domMutationEmitter.pipe(\r\n      takeWhile(() => this.state.initMode),\r\n      debounceTime(this.scrollDebounceTimeAfterDOMMutationOnInit)\r\n    ).subscribe(() => {\r\n      this.scrollingStrategy.setInitialScrollPosition();\r\n      this.state.initMode = false;\r\n    });\r\n  }\r\n\r\n  private registerPreviousScrollPositionHandler(): void {\r\n    zip(\r\n      this.scrollRequestZoneChanged,\r\n      this.scrollHeightChanged\r\n    ).pipe(\r\n      skipWhile(() => this.state.initMode),\r\n      debounceTime(this.scrollDebounceTimeAfterScrollHeightChanged)\r\n    ).subscribe(() => {\r\n      this.scrollingStrategy.setPreviousScrollPosition();\r\n      this.state.previousScrollPositionpUpdated = true;\r\n    });\r\n  }\r\n\r\n  private registerScrollSpy(): void {\r\n    this.scrollRequestZoneChanged.subscribe(() => {\r\n      this.scrollingStrategy.askForUpdate();\r\n    });\r\n  }\r\n\r\n  private useStrategy(): void {\r\n    switch (this.strategy) {\r\n      case 'scrollingToBoth':\r\n        this.scrollingStrategy = new ScrollingToBoth(this, this.state);\r\n        break;\r\n      case 'scrollingToTop':\r\n        this.scrollingStrategy = new ScrollingToTop(this, this.state);\r\n        break;\r\n      case 'scrollingToBottom': default:\r\n        this.scrollingStrategy = new ScrollingToBottom(this, this.state);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private useScrollHeightListener(): void {\r\n    this.scrollHeightListener = new ScrollHeightListener(this, this.state);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\n\nimport { NgxInfiniteScrollerDirective } from './ngx-infinite-scroller.directive';\nimport { DirectiveStateService } from './directive-state.service';\n\n@NgModule({\n  declarations: [\n    NgxInfiniteScrollerDirective\n  ],\n  imports: [\n  ],\n  exports: [\n    NgxInfiniteScrollerDirective\n  ],\n  providers: [\n    DirectiveStateService\n  ],\n  bootstrap: []\n})\nexport class NgxInfiniteScrollerModule { }\n"]}